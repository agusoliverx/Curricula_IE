<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Malla Curricular</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 1200px;
      margin: auto;
    }

    h1 {
      text-align: center;
    }

    #creditos-contador {
      font-weight: bold;
      margin-bottom: 10px;
      text-align: center;
    }

    .progreso-container {
      width: 100%;
      background: #ddd;
      border-radius: 20px;
      overflow: hidden;
      margin-bottom: 20px;
    }

    #barra-progreso {
      height: 20px;
      background: #4caf50;
      width: 0%;
      transition: width 0.3s;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }

    th {
      background-color: #f0f0f0;
      text-align: center;
      padding: 10px;
    }

    td {
      vertical-align: top;
      text-align: center;
      padding: 10px;
    }

    .course {
      background-color: #e0e0e0;
      padding: 10px;
      margin: 5px 0;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.85rem;
      transition: background-color 0.3s;
    }

    .course:hover {
      background-color: #d0d0d0;
    }

    .completed {
      background-color: #b3e5b3 !important;
    }
  </style>
</head>
<body>
  <h1>Malla Curricular</h1>
  <div id="creditos-contador">Créditos completados: 0 / 450</div>
  <div class="progreso-container">
    <div id="barra-progreso"></div>
  </div>

  <table border="1">
    <thead>
      <tr>
        <th>Año/Semestre</th>
        <th>Materias</th>
      </tr>
    </thead>
    <tbody id="malla"></tbody>
  </table>

  <script>
    const malla = {
      1: [["Cálculo dif. e integral en una variable", 13], ["GAL 1", 9], ["Física 1", 10]],
      2: [["Cálculo dif. e integral en varias variables", 13], ["GAL 2", 9], ["Física 2", 10], ["Programación 1", 10]],
      3: [["Cálculo Vectorial", 10], ["Probabilidad y Estadística", 10], ["Física 3", 10], ["Mecánica Newtoniana", 10], ["Física Experimental 1", 5]],
      4: [["Ecuaciones Diferenciales", 10], ["Electromagnetismo", 10], ["Física Experimental 2", 5], ["Teoría de Circuitos", 8], ["Diseño Lógico", 12]],
      5: [["Funciones de Variable Compleja", 5], ["Señales y Sistemas", 11], ["Intro. a los microprocesadores", 11], ["Programación 2", 12], ["Electrónica Fundamental", 11]],
      6: [["Métodos numéricos", 8], ["Sistemas y Control", 12], ["Taller Fourier", 8], ["Señales aleatorias y Modulación", 8]],
      7: [["Medidas Eléctricas", 10], ["Estimación y predicción en series temporales", 10]],
      8: [["Pasantía", 10], ["Redes de Datos I", 8], ["Ingeniería Biomédica", 8], ["AIMDs", 8]],
      9: [["Proyecto", 10], ["Electrotecnia", 10]],
      10: [["Proyecto", 25], ["Legislación y relaciones industriales", 6], ["Economía", 7], ["Instalaciones Eléctricas", 8]]
    };

    const previas = {
      "Cálculo dif. e integral en una variable": [],
      "GAL 1": [],
      "Física 1": [],
      "Cálculo dif. e integral en varias variables": ["Cálculo dif. e integral en una variable"],
      "GAL 2": ["GAL 1"],
      "Física 2": ["Cálculo dif. e integral en una variable", "Física 1"],
      "Programación 1": [],
      "Cálculo Vectorial": ["Cálculo dif. e integral en varias variables", "Cálculo dif. e integral en una variable", "GAL 1"],
      "Probabilidad y Estadística": ["Cálculo dif. e integral en una variable", "Cálculo dif. e integral en varias variables", "GAL 1"],
      "Física 3": ["Cálculo dif. e integral en una variable"],
      "Mecánica Newtoniana": ["Física 1", "Cálculo dif. e integral en varias variables", "Física 2 o Física 3", "Cálculo dif. e integral en una variable"],
      "Física Experimental 1": ["Física 1"],
      "Ecuaciones Diferenciales": ["Cálculo dif. e integral en una variable", "Cálculo dif. e integral en varias variables", "GAL 1", "GAL 2"],
      "Electromagnetismo": ["GAL 1", "GAL 2", "Cálculo dif. e integral en una variable", "Cálculo dif. e integral en varias variables", "Cálculo Vectorial"],
      "Física Experimental 2": ["Física Experimental 1", "Física 3"],
      "Teoría de Circuitos": ["Física 1", "Física 3", "Cálculo dif. e integral en una variable", "Cálculo dif. e integral en varias variables", "GAL 1"],
      "Diseño Lógico": [],
      "Funciones de Variable Compleja": [],
      "Señales y Sistemas": [],
      "Intro. a los microprocesadores": [],
      "Programación 2": [],
      "Electrónica Fundamental": [],
      "Métodos numéricos": [],
      "Sistemas y Control": [],
      "Taller Fourier": [],
      "Señales aleatorias y Modulación": [],
      "Medidas Eléctricas": [],
      "Estimación y predicción en series temporales": [],
      "Pasantía": [],
      "Redes de Datos I": [],
      "Ingeniería Biomédica": [],
      "AIMDs": [],
      "Proyecto": [],
      "Electrotecnia": [],
      "Legislación y relaciones industriales": [],
      "Economía": [],
      "Instalaciones Eléctricas": []
    };

    const tbody = document.getElementById("malla");
    const estadoGuardado = JSON.parse(localStorage.getItem("materiasCompletadas") || "[]");

    Object.entries(malla).forEach(([semestre, materias]) => {
      const tr = document.createElement("tr");
      const tdSem = document.createElement("td");
      tdSem.textContent = `Semestre ${semestre}`;
      tr.appendChild(tdSem);

      const td = document.createElement("td");

      materias.forEach(([nombre, creditos]) => {
        const div = document.createElement("div");
        div.className = "course";
        div.textContent = `${nombre} (${creditos} cr)`;
        div.dataset.nombre = nombre;
        div.dataset.creditos = creditos;

        if (estadoGuardado.includes(nombre)) {
          div.classList.add("completed");
        }

        const requisitos = previas[nombre] || [];
        div.title = requisitos.length > 0
          ? `Previas:\n- ${requisitos.join("\n- ")}`
          : "Sin previas";

        div.addEventListener("click", () => {
          if (div.classList.contains("completed")) {
            div.classList.remove("completed");
          } else {
            if (requisitosCompletos(requisitos)) {
              div.classList.add("completed");
            } else {
              alert("No podés marcar esta materia porque no cumplís todas las previas.");
            }
          }
          guardarEstado();
          actualizarCreditos();
        });

        td.appendChild(div);
      });

      tr.appendChild(td);
      tbody.appendChild(tr);
    });

    function requisitosCompletos(requisitos) {
      return requisitos.every(nombre => {
        if (nombre.includes(" o ")) {
          return nombre.split(" o ").some(opcion => estaCompletada(opcion));
        }
        return estaCompletada(nombre);
      });
    }

    function estaCompletada(nombre) {
      return [...document.querySelectorAll(".course.completed")].some(div =>
        div.dataset.nombre === nombre
      );
    }

    function actualizarCreditos() {
      const materias = document.querySelectorAll(".course.completed");
      let suma = 0;
      materias.forEach(div => {
        suma += parseInt(div.dataset.creditos);
      });

      const total = 450;
      const porcentaje = Math.min((suma / total) * 100, 100).toFixed(2);

      document.getElementById("creditos-contador").textContent =
        `Créditos completados: ${suma} / ${total}`;

      document.getElementById("barra-progreso").style.width = `${porcentaje}%`;
    }

    function guardarEstado() {
      const completadas = [...document.querySelectorAll(".course.completed")]
        .map(div => div.dataset.nombre);
      localStorage.setItem("materiasCompletadas", JSON.stringify(completadas));
    }

    actualizarCreditos(); // mostrar progreso inicial
  </script>
</body>
</html>
